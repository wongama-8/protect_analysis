<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protection Analysis Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            padding: 1.5rem 2rem;
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
            transform: translateY(-2px);
        }
        .input-group label {
            color: #475569;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .input-group input {
            border-color: #cbd5e1;
            transition: all 0.2s ease-in-out;
        }
        .input-group input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        .btn-primary {
            background-image: linear-gradient(to right, #4f46e5, #6366f1);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px -1px rgba(79, 70, 229, 0.25);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px -2px rgba(79, 70, 229, 0.3);
        }
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.75rem;
            margin-bottom: 1.25rem;
        }
        .section-header svg {
            width: 1.5rem;
            height: 1.5rem;
        }
        .spotlight-card {
            background-color: white;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            text-align: center;
            transition: all 0.3s ease-in-out;
        }
        .spotlight-card:hover {
             transform: translateY(-4px);
             box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .value-card {
            background: linear-gradient(135deg, #f5f3ff, #faf5ff);
            border: 1px solid #ddd6fe;
        }
        .disabled-section {
            opacity: 0.5;
            pointer-events: none;
        }
        .breakdown-list-item {
            background-color: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.2s ease-in-out;
        }
        .breakdown-list-item.goal-achieved {
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-screen-xl">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900">Protection Analysis</h1>
            <p class="mt-3 text-lg text-gray-600 max-w-2xl mx-auto">A personalized look at your financial safety net.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Left Column: Inputs -->
            <div class="lg:col-span-4">
                <div class="card space-y-8">
                    <!-- Step 1-3 Inputs -->
                    <div>
                        <div class="section-header">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                            <h2>Client Details</h2>
                        </div>
                        <div class="input-group">
                            <label for="annualIncome" class="block mb-2">Client's Annual Income (RM)</label>
                            <input type="number" id="annualIncome" class="w-full p-2.5 border rounded-lg" placeholder="e.g., 120000">
                        </div>
                    </div>
                    <div>
                        <div class="section-header">
                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" /></svg>
                            <h3>Protection Benchmarks</h3>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="input-group"><label for="ruleLife">Life (x Income)</label><input type="number" id="ruleLife" class="w-full p-2.5 border rounded-lg" placeholder="e.g., 5"></div>
                            <div class="input-group"><label for="ruleCi">CI (x Income)</label><input type="number" id="ruleCi" class="w-full p-2.5 border rounded-lg" placeholder="e.g., 3"></div>
                            <div class="input-group"><label for="ruleAd">Accident (x Income)</label><input type="number" id="ruleAd" class="w-full p-2.5 border rounded-lg" placeholder="e.g., 5"></div>
                            <div class="input-group"><label for="ruleMed">Medical (RM)</label><input type="number" id="ruleMed" class="w-full p-2.5 border rounded-lg" placeholder="e.g., 1000000"></div>
                        </div>
                    </div>
                    <div>
                        <div class="section-header">
                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286zm0 13.036h.008v.008h-.008v-.008z" /></svg>
                            <h3>Existing Coverage (RM)</h3>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="input-group"><label for="lifeInsurance">Life Insurance</label><input type="number" id="lifeInsurance" class="w-full p-2.5 border rounded-lg" placeholder="0"></div>
                            <div class="input-group"><label for="criticalIllness">Critical Illness</label><input type="number" id="criticalIllness" class="w-full p-2.5 border rounded-lg" placeholder="0"></div>
                            <div class="input-group"><label for="accidentalDeath">Accidental Death</label><input type="number" id="accidentalDeath" class="w-full p-2.5 border rounded-lg" placeholder="0"></div>
                            <div class="input-group"><label for="medical">Medical</label><input type="number" id="medical" class="w-full p-2.5 border rounded-lg" placeholder="0"></div>
                        </div>
                    </div>
                    <!-- Step 4: Proposed Plan -->
                    <div id="proposedSection" class="disabled-section">
                        <div class="section-header text-emerald-600">
                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            <h3>Your New Plan (Proposed)</h3>
                        </div>
                         <div class="grid grid-cols-2 gap-4">
                            <div class="input-group"><label for="proposedLife">Life Insurance</label><input type="number" id="proposedLife" class="w-full p-2.5 border rounded-lg" placeholder="0"></div>
                            <div class="input-group"><label for="proposedCi">Critical Illness</label><input type="number" id="proposedCi" class="w-full p-2.5 border rounded-lg" placeholder="0"></div>
                            <div class="input-group"><label for="proposedAd">Accidental Death</label><input type="number" id="proposedAd" class="w-full p-2.5 border rounded-lg" placeholder="0"></div>
                            <div class="input-group"><label for="proposedMed">Medical</label><input type="number" id="proposedMed" class="w-full p-2.5 border rounded-lg" placeholder="0"></div>
                        </div>
                         <div class="input-group mt-4">
                            <label for="proposedPremium" class="block mb-2">Proposed Monthly Premium (RM)</label>
                            <input type="number" id="proposedPremium" class="w-full p-2.5 border rounded-lg" placeholder="0">
                        </div>
                    </div>
                    <button id="updateButton" class="w-full btn-primary text-white font-bold py-3 px-4 rounded-lg text-lg mt-4">Analyze Protection Gap</button>
                </div>
            </div>

            <!-- Right Column: Outputs -->
            <div class="lg:col-span-8 space-y-8">
                <!-- Summary Cards -->
                <div id="summaryCard" class="card hidden">
                     <div class="flex justify-between items-center mb-6">
                        <h2 id="summaryTitle" class="text-2xl font-bold text-slate-700">Your Protection Summary</h2>
                    </div>
                    <div id="summaryCardsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                        <!-- Summary Cards will be injected here -->
                    </div>
                </div>

                <!-- Value Proposition Card -->
                <div id="valueCard" class="card value-card hidden">
                    <h2 class="text-2xl font-bold text-slate-700 text-center mb-4">Your Plan's Value</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-center text-center">
                        <div>
                            <p class="text-lg font-medium text-slate-600">Your Monthly Investment</p>
                            <p id="valuePremium" class="text-4xl font-extrabold text-indigo-600"></p>
                        </div>
                        <div class="text-2xl font-light text-slate-400 hidden md:block self-center">→</div>
                        <div class="text-left">
                            <p class="text-lg font-medium text-slate-600">Your Protection Breakdown</p>
                            <div id="valueProtectionBreakdown" class="mt-2 text-slate-800 font-semibold space-y-1"></div>
                            <hr class="my-2 border-slate-300">
                            <p id="valueProtectionTotal" class="text-xl font-bold text-slate-900"></p>
                        </div>
                    </div>
                </div>

                <!-- Summary Table -->
                <div id="breakdownCard" class="card hidden">
                    <h2 class="text-xl font-bold mb-4 text-slate-700">Detailed Breakdown</h2>
                    <div id="breakdownListContainer" class="space-y-2">
                        <!-- Breakdown list items will be injected here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const annualIncomeEl = document.getElementById('annualIncome');
        const updateButton = document.getElementById('updateButton');
        const summaryCardsContainer = document.getElementById('summaryCardsContainer');
        const proposedSection = document.getElementById('proposedSection');
        const valueCard = document.getElementById('valueCard');
        const breakdownCard = document.getElementById('breakdownCard');
        const breakdownListContainer = document.getElementById('breakdownListContainer');
        const summaryCard = document.getElementById('summaryCard');
        const summaryTitle = document.getElementById('summaryTitle');
        
        let hasAnalyzedGap = false;

        const inputs = {
            rules: { life: document.getElementById('ruleLife'), ci: document.getElementById('ruleCi'), ad: document.getElementById('ruleAd'), med: document.getElementById('ruleMed') },
            existing: { life: document.getElementById('lifeInsurance'), ci: document.getElementById('criticalIllness'), ad: document.getElementById('accidentalDeath'), med: document.getElementById('medical') },
            proposed: { life: document.getElementById('proposedLife'), ci: document.getElementById('proposedCi'), ad: document.getElementById('proposedAd'), med: document.getElementById('proposedMed') },
            premium: document.getElementById('proposedPremium')
        };
        
        const allInputs = document.querySelectorAll('#annualIncome, #ruleLife, #ruleCi, #ruleAd, #ruleMed, #lifeInsurance, #criticalIllness, #accidentalDeath, #medical');

        const formatCurrency = (value) => `RM ${Math.round(value).toLocaleString('en-US')}`;

        function calculateAnalysis(isSolutionAnalysis) {
            const income = parseFloat(annualIncomeEl.value) || 0;
            const rules = {
                life: parseFloat(inputs.rules.life.value) || 0,
                ci: parseFloat(inputs.rules.ci.value) || 0,
                ad: parseFloat(inputs.rules.ad.value) || 0,
                med: parseFloat(inputs.rules.med.value) || 0,
            };

            const existing = {}, proposed = {}, newTotal = {}, recommended = {}, initialGap = {}, finalGap = {};
            let totalNewProtection = 0;
            const keys = ['life', 'ci', 'ad', 'med'];
            
            keys.forEach(key => {
                existing[key] = parseFloat(inputs.existing[key].value) || 0;
                proposed[key] = isSolutionAnalysis ? (parseFloat(inputs.proposed[key].value) || 0) : 0;
                newTotal[key] = existing[key] + proposed[key];
                totalNewProtection += proposed[key];
            });

            recommended.life = income * rules.life;
            recommended.ci = income * rules.ci;
            recommended.ad = income * rules.ad;
            recommended.med = rules.med;

            keys.forEach(key => {
                initialGap[key] = Math.max(0, recommended[key] - existing[key]);
                finalGap[key] = Math.max(0, recommended[key] - newTotal[key]);
            });

            const proposedPremium = parseFloat(inputs.premium.value) || 0;

            return { existing, proposed, newTotal, recommended, initialGap, finalGap, proposedPremium, totalNewProtection };
        }
        
        function updateView(isSolutionView) {
             if (isSolutionView) {
                valueCard.classList.remove('hidden');
                breakdownCard.classList.remove('hidden');
                summaryTitle.textContent = 'Your Protection Summary';
            } else {
                valueCard.classList.add('hidden');
                breakdownCard.classList.add('hidden');
                summaryTitle.textContent = 'Your Current Protection Gap';
            }
        }

        function updateValueCard({ proposed, proposedPremium, totalNewProtection }) {
            document.getElementById('valuePremium').textContent = formatCurrency(proposedPremium);
            const breakdownEl = document.getElementById('valueProtectionBreakdown');
            breakdownEl.innerHTML = '';
            const names = {life: 'Life Insurance', ci: 'Critical Illness', ad: 'Accidental Death', med: 'Medical'};
            Object.keys(proposed).forEach(key => {
                if (proposed[key] > 0) {
                    breakdownEl.innerHTML += `<div><span>${names[key]}:</span> <span class="font-bold">${formatCurrency(proposed[key])}</span></div>`;
                }
            });
            document.getElementById('valueProtectionTotal').textContent = `Total Secured: ${formatCurrency(totalNewProtection)}`;
        }

        function updateBreakdownList({ existing, proposed, newTotal, recommended }, isSolutionView) {
            breakdownListContainer.innerHTML = '';
            const keys = ['life', 'ci', 'ad', 'med'];
            const names = ['Life Insurance', 'Critical Illness', 'Accidental Death', 'Medical'];

            names.forEach((name, index) => {
                const key = keys[index];
                const total = newTotal[key];
                const shortfall = recommended[key] - total;
                const isGoalMet = shortfall <= 0;
                
                let statusHTML = '';
                if (isGoalMet) {
                    statusHTML = `<div class="text-emerald-500 text-3xl">✔</div>`;
                } else {
                    statusHTML = `<div class="text-indigo-500 text-3xl">◆</div>`;
                }

                const buildUpHTML = `
                    <div class="text-slate-600 text-sm">
                        ${formatCurrency(existing[key])} <span class="text-slate-400">(Current)</span> + 
                        <span class="text-emerald-600 font-semibold">${formatCurrency(proposed[key])}</span> <span class="text-slate-400">(New Plan)</span>
                    </div>
                `;

                const row = `
                    <div class="breakdown-list-item ${isGoalMet ? 'goal-achieved' : ''}">
                        <div>
                            <p class="font-bold text-slate-800 text-lg">${name}</p>
                            <p class="text-sm text-slate-500">Benchmark: ${formatCurrency(recommended[key])}</p>
                        </div>
                        <div class="text-right">
                            ${buildUpHTML}
                            <p class="text-2xl font-bold text-slate-900 mt-1">= ${formatCurrency(total)}</p>
                        </div>
                        <div class="w-10 text-center">${statusHTML}</div>
                    </div>
                `;
                if(isSolutionView) {
                    breakdownListContainer.innerHTML += row;
                }
            });
        }
        
        function createOrUpdateSummaryCards(analysis, isSolutionView) {
            const { existing, proposed, newTotal, recommended, initialGap, finalGap } = analysis;
            const keys = ['life', 'ci', 'ad', 'med'];
            const names = [
                { title: 'Life', subtitle: 'A Legacy of Protection'},
                { title: 'Critical Illness', subtitle: 'Financial Relief'},
                { title: 'Accidental', subtitle: 'Against the Unexpected'},
                { title: 'Health/Medical', subtitle: 'Shield Against Costs'}
            ];
            
            if (summaryCardsContainer.children.length === 0) {
                keys.forEach((key, index) => {
                    const cardHTML = `
                        <div id="card-${key}" class="spotlight-card">
                            <div class="flex items-center gap-3 text-left">
                                <span id="icon-${key}" class="text-3xl"></span>
                                <div>
                                    <h3 class="text-xl font-bold text-slate-800 leading-tight">${names[index].title}</h3>
                                    <p class="text-sm text-slate-500 font-medium">${names[index].subtitle}</p>
                                </div>
                            </div>
                            <div id="spotlight-content-${key}" class="flex-grow my-4">
                                <!-- Spotlight content is injected here -->
                            </div>
                        </div>
                    `;
                    summaryCardsContainer.innerHTML += cardHTML;
                });
            }

            keys.forEach((key, index) => {
                const rec = recommended[key];
                const ex = existing[key];
                const total = newTotal[key];
                
                const iconEl = document.getElementById(`icon-${key}`);
                const icons = ['👨‍👩‍👧‍👦', '❤️‍🩹', '☂️', '🛡️'];
                iconEl.textContent = icons[index];

                const spotlightContent = document.getElementById(`spotlight-content-${key}`);

                if (isSolutionView) {
                    if (total >= rec) { // Celebration Card
                        spotlightContent.innerHTML = `
                            <div class="flex flex-col items-center justify-center h-full">
                                <div class="text-5xl text-emerald-500">✔</div>
                                <div class="text-xl font-bold text-emerald-700 mt-2">Benchmark Achieved!</div>
                                <p class="text-sm text-slate-500 mt-2">Your Total: <b>${formatCurrency(total)}</b> | Benchmark: <b>${formatCurrency(rec)}</b></p>
                            </div>
                        `;
                    } else { // Next Milestone Card
                         spotlightContent.innerHTML = `
                            <p class="text-base font-semibold text-indigo-700">Next Milestone</p>
                            <p class="text-4xl font-extrabold text-indigo-600">${formatCurrency(finalGap[key])}</p>
                            <p class="text-base text-slate-500 mt-4">You have secured <b>${formatCurrency(total)}</b> of your <b>${formatCurrency(rec)}</b> benchmark.</p>
                        `;
                    }
                } else { // Gap View
                    if (initialGap[key] > 0) { // Shortfall Card
                         spotlightContent.innerHTML = `
                            <p class="text-base font-semibold text-rose-700">Protection Shortfall</p>
                            <p class="text-4xl font-extrabold text-rose-600">${formatCurrency(initialGap[key])}</p>
                            <p class="text-base text-slate-500 mt-4">You currently have <b>${formatCurrency(ex)}</b> of the recommended <b>${formatCurrency(rec)}</b> benchmark.</p>
                        `;
                    } else { // Benchmark Achieved Card (Before)
                        spotlightContent.innerHTML = `
                            <div class="flex flex-col items-center justify-center h-full">
                                <div class="text-5xl text-emerald-500">✔</div>
                                <div class="text-xl font-bold text-emerald-700 mt-2">Benchmark Achieved!</div>
                                <p class="text-sm text-slate-500 mt-2">Your Total: <b>${formatCurrency(ex)}</b> | Benchmark: <b>${formatCurrency(rec)}</b></p>
                            </div>
                        `;
                    }
                }
            });
        }

        updateButton.addEventListener('click', () => {
            summaryCard.classList.remove('hidden');
            
            if (hasAnalyzedGap) {
                // This is the "Update with Solution" click
                runAnalysis(true);
            } else {
                // This is the "Analyze Protection Gap" click
                runAnalysis(false);
                hasAnalyzedGap = true;
                proposedSection.classList.remove('disabled-section');
                updateButton.textContent = 'Update With Solution';
            }
        });

        function setupReAnalysisTriggers() {
            allInputs.forEach(input => {
                input.addEventListener('input', () => {
                    if (hasAnalyzedGap) {
                        hasAnalyzedGap = false;
                        proposedSection.classList.add('disabled-section');
                        updateButton.textContent = 'Analyze Protection Gap';
                    }
                });
            });
        }
        
        function runAnalysis(isSolution) {
            const analysis = calculateAnalysis(isSolution);
            updateView(isSolution);
            createOrUpdateSummaryCards(analysis, isSolution);
            updateBreakdownList(analysis, isSolution);
            if (isSolution) {
                updateValueCard(analysis);
            }
        }

        window.onload = () => {
            if (summaryCardsContainer.children.length === 0) {
                 createOrUpdateSummaryCards(calculateAnalysis(false), false);
            }
            summaryCard.classList.add('hidden');
            breakdownCard.classList.add('hidden');
            setupReAnalysisTriggers();
        };
    </script>
</body>
</html>
