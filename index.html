<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Protection Analysis</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .progress-bar-container {
            position: relative;
            height: 1.5rem;
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            transition: width 0.5s ease-in-out;
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            box-sizing: border-box;
        }
        .benchmark-marker {
            position: absolute;
            top: 0;
            left: 100%;
            height: 100%;
            width: 2px;
            background-color: transparent;
            transform: translateX(-100%);
            border-left: 2px dashed #9ca3af;
        }
        .benchmark-marker::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0%;
            transform: translate(-50%, -50%);
            width: 1rem;
            height: 1rem;
            background-color: #9ca3af;
            border-radius: 50%;
        }
        .progress-label {
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
            white-space: nowrap;
        }
        /* New Styles for Two-Bar Comparison */
        .two-bar-comparison-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .two-bar-comparison-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .two-bar-comparison-bar {
            height: 2rem;
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
            display: flex;
            align-items: center;
            padding-left: 1rem;
            color: white;
            font-weight: bold;
            font-size: 0.875rem;
        }
        .two-bar-comparison-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #4b5563;
        }
    </style>
</head>
<body class="p-4 sm:p-8 md:p-12">

    <div class="max-w-6xl mx-auto bg-white rounded-3xl shadow-2xl p-6 sm:p-10 md:p-12 lg:p-16">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Protection Analysis Tool</h1>
        </header>

        <!-- Customer Type Toggle -->
        <div class="mb-8 flex justify-center">
            <div class="flex items-center space-x-4 p-2 bg-gray-100 rounded-full shadow-inner">
                <button id="newCustomerBtn" class="px-6 py-2 rounded-full text-white bg-blue-600 font-medium transition-colors duration-200 ease-in-out">
                    New
                </button>
                <button id="existingCustomerBtn" class="px-6 py-2 rounded-full text-gray-600 bg-transparent font-medium transition-colors duration-200 ease-in-out">
                    Existing
                </button>
            </div>
        </div>

        <!-- Main Form Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
            <!-- Inputs Section -->
            <div class="lg:col-span-1 bg-gray-50 p-6 rounded-2xl shadow-inner">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-blue-500"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Client Details
                </h2>
                
                <!-- Annual Income -->
                <div class="mb-6">
                    <label for="annualIncome" class="block text-gray-700 font-medium mb-2">Estimate Annual Income (RM)</label>
                    <input type="number" id="annualIncome" placeholder="e.g., 60000" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
                </div>

                <!-- Benchmarks -->
                <h3 class="text-xl font-medium text-gray-800 mb-4 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-yellow-500"><path d="M12 2L2 7l10 5l10-5l-10-5z"/><path d="M2 17l10 5l10-5"/><path d="M2 12l10 5l10-5"/></svg>
                    Protection Benchmarks
                </h3>
                
                <div class="space-y-4 mb-6">
                    <!-- Life Benchmark -->
                    <div class="flex items-center justify-between">
                        <label for="lifeMultiplier" class="text-gray-600">Life (x Income)</label>
                        <input type="number" id="lifeMultiplier" value="5" min="1" class="w-20 px-2 py-1 border rounded-md text-center">
                    </div>
                    <!-- CI Benchmark -->
                    <div class="flex items-center justify-between">
                        <label for="ciMultiplier" class="text-gray-600">CI (x Income)</label>
                        <input type="number" id="ciMultiplier" value="3" min="1" class="w-20 px-2 py-1 border rounded-md text-center">
                    </div>
                    <!-- Accident Benchmark -->
                    <div class="flex items-center justify-between">
                        <label for="accidentMultiplier" class="text-gray-600">Accident (x Income)</label>
                        <input type="number" id="accidentMultiplier" value="3" min="1" class="w-20 px-2 py-1 border rounded-md text-center">
                    </div>
                    <!-- Medical Benchmark -->
                    <div class="flex items-center justify-between">
                        <label for="medicalBenchmark" class="text-gray-600">Medical (RM)</label>
                        <input type="number" id="medicalBenchmark" value="1000000" min="100000" step="100000" class="w-36 px-2 py-1 border rounded-md text-center">
                    </div>
                </div>

                <!-- Existing Policy Section (conditionally displayed) -->
                <div id="existingPolicySection" class="hidden">
                    <h3 class="text-xl font-medium text-gray-800 mb-4 mt-6 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-green-500"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        Existing Policy Coverage (RM)
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <label for="existingLife" class="text-gray-600">Life Insurance</label>
                            <input type="number" id="existingLife" placeholder="e.g., 100000" class="w-36 px-2 py-1 border rounded-md text-center">
                        </div>
                        <div class="flex items-center justify-between">
                            <label for="existingCI" class="text-gray-600">Critical Illness</label>
                            <input type="number" id="existingCI" placeholder="e.g., 50000" class="w-36 px-2 py-1 border rounded-md text-center">
                        </div>
                        <div class="flex items-center justify-between">
                            <label for="existingAccident" class="text-gray-600">Accidental</label>
                            <input type="number" id="existingAccident" placeholder="e.g., 50000" class="w-36 px-2 py-1 border rounded-md text-center">
                        </div>
                        <div class="flex items-center justify-between">
                            <label for="existingMedical" class="text-gray-600">Health/Medical</label>
                            <input type="number" id="existingMedical" placeholder="e.g., 200000" class="w-36 px-2 py-1 border rounded-md text-center">
                        </div>
                    </div>
                    <div class="mt-6 flex items-center justify-between">
                        <label for="existingPremium" class="text-gray-600">Existing Premium</label>
                        <div class="flex items-center gap-2">
                            <input type="number" id="existingPremium" placeholder="e.g., 1200" class="w-32 px-2 py-1 border rounded-md text-center">
                            <select id="existingPremiumFrequency" class="px-2 py-1 border rounded-md">
                                <option value="annually">Annually</option>
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="half-yearly">Half-yearly</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Proposed Plan -->
                <h3 class="text-xl font-medium text-gray-800 mb-4 mt-6 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-purple-500"><path d="M4 12V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v6"/><path d="M12 18V4"/><path d="M16 12H8"/><path d="M21 16H3"/></svg>
                    Your Proposed Plan (RM)
                </h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <label for="proposedLife" class="text-gray-600">Life Insurance</label>
                        <input type="number" id="proposedLife" placeholder="e.g., 100000" class="w-36 px-2 py-1 border rounded-md text-center">
                    </div>
                    <div class="flex items-center justify-between">
                        <label for="proposedCI" class="text-gray-600">Critical Illness</label>
                        <input type="number" id="proposedCI" placeholder="e.g., 50000" class="w-36 px-2 py-1 border rounded-md text-center">
                    </div>
                    <div class="flex items-center justify-between">
                        <label for="proposedAccident" class="text-gray-600">Accidental</label>
                        <input type="number" id="proposedAccident" placeholder="e.g., 50000" class="w-36 px-2 py-1 border rounded-md text-center">
                    </div>
                    <div class="flex items-center justify-between">
                        <label for="proposedMedical" class="text-gray-600">Health/Medical</label>
                        <input type="number" id="proposedMedical" placeholder="e.g., 200000" class="w-36 px-2 py-1 border rounded-md text-center">
                    </div>
                </div>

                <div class="mt-6 flex items-center justify-between">
                    <label for="proposedPremium" class="text-gray-600">Proposed Premium</label>
                    <div class="flex items-center gap-2">
                        <input type="number" id="proposedPremium" placeholder="e.g., 1200" class="w-32 px-2 py-1 border rounded-md text-center">
                        <select id="proposedPremiumFrequency" class="px-2 py-1 border rounded-md">
                            <option value="annually">Annually</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="half-yearly">Half-yearly</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsPanel" class="lg:col-span-2 bg-gray-50 p-6 rounded-2xl shadow-inner flex flex-col justify-between">
                <!-- Results will be dynamically generated here -->
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const annualIncomeInput = document.getElementById('annualIncome');
        const lifeMultiplierInput = document.getElementById('lifeMultiplier');
        const ciMultiplierInput = document.getElementById('ciMultiplier');
        const accidentMultiplierInput = document.getElementById('accidentMultiplier');
        const medicalBenchmarkInput = document.getElementById('medicalBenchmark');

        const newCustomerBtn = document.getElementById('newCustomerBtn');
        const existingCustomerBtn = document.getElementById('existingCustomerBtn');
        const existingPolicySection = document.getElementById('existingPolicySection');

        const existingLifeInput = document.getElementById('existingLife');
        const existingCIInput = document.getElementById('existingCI');
        const existingAccidentInput = document.getElementById('existingAccident');
        const existingMedicalInput = document.getElementById('existingMedical');
        const existingPremiumInput = document.getElementById('existingPremium');
        const existingPremiumFrequencySelect = document.getElementById('existingPremiumFrequency');

        const proposedLifeInput = document.getElementById('proposedLife');
        const proposedCIInput = document.getElementById('proposedCI');
        const proposedAccidentInput = document.getElementById('proposedAccident');
        const proposedMedicalInput = document.getElementById('proposedMedical');
        const proposedPremiumInput = document.getElementById('proposedPremium');
        const proposedPremiumFrequencySelect = document.getElementById('proposedPremiumFrequency');
        
        const resultsPanel = document.getElementById('resultsPanel');


        // --- State Variables ---
        let isExistingCustomer = false;

        // --- Helper Functions ---

        /**
         * Formats a number as a currency string with RM prefix.
         * @param {number} value The number to format.
         * @param {boolean} shorten If true, shorten large numbers (e.g., 100K, 1.2M).
         * @returns {string} The formatted currency string.
         */
        function formatCurrency(value, shorten = false) {
            if (typeof value !== 'number' || isNaN(value) || value === 0) return 'RM 0';
            
            if (shorten) {
                if (value >= 1000000) {
                    return `RM ${(value / 1000000).toFixed(1)}M`;
                } else if (value >= 1000) {
                    return `RM ${(value / 1000).toFixed(0)}K`;
                }
            }
            
            return `RM ${value.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
        }
        
        /**
         * Converts premium amount to annual value based on frequency.
         * @param {number} premium The premium amount.
         * @param {string} frequency The premium frequency (e.g., 'monthly').
         * @returns {number} The annual premium value.
         */
        function getAnnualPremium(premium, frequency) {
            switch (frequency) {
                case 'monthly':
                    return premium * 12;
                case 'quarterly':
                    return premium * 4;
                case 'half-yearly':
                    return premium * 2;
                case 'annually':
                default:
                    return premium;
            }
        }
        
        /**
         * Creates an SVG icon for the results section.
         * @param {string} dPath The SVG path data.
         * @param {string} color The Tailwind CSS color class.
         * @returns {string} The HTML string for the SVG.
         */
        function createIcon(dPath, color) {
            return `
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 ${color}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    ${dPath}
                </svg>
            `;
        }
        
        /**
         * Generates the HTML for a single visual comparison block.
         * @param {string} title The title of the comparison (e.g., "Life Coverage").
         * @param {string} iconSvg The SVG icon HTML string.
         * @param {number} benchmark The target benchmark value.
         * @param {number} existing The existing coverage value.
         * @param {number} proposed The proposed coverage value.
         * @param {boolean} isProposedImpact If true, this is the "Proposed Plan Impact" block.
         * @returns {string} The HTML string for the visual comparison block.
         */
        function createComparisonBlock(title, iconSvg, benchmark, existing, proposed, isProposedImpact) {
            const totalCoverage = existing + proposed;
            
            // Calculate percentages based on benchmark
            const existingPercentage = (existing / benchmark) * 100;
            const proposedPercentage = (proposed / benchmark) * 100;
            const totalPercentage = (totalCoverage / benchmark) * 100;

            let statusText = '';
            
            if (isProposedImpact) {
                if (proposed === 0 && existing < benchmark) {
                    statusText = 'Not in Proposed Plan';
                } else if (totalCoverage >= benchmark) {
                    statusText = 'Goal Achieved!';
                } else {
                    statusText = 'Moving towards the goal';
                }
            } else { // This is for "Existing Plan vs. Benchmarks"
                if (existing >= benchmark) {
                    statusText = 'Goal Achieved!';
                } else {
                    statusText = 'Moving towards the goal';
                }
            }


            let existingBarHtml = '';
            let proposedBarHtml = '';
            
            const MIN_LABEL_WIDTH_PERCENT = 10; // Minimum percentage for a label to be visible

            // Render existing bar and its label
            if (isExistingCustomer && existing > 0) {
                const existingLabel = formatCurrency(existing, true);
                const barWidth = `${Math.min(existingPercentage, 100)}%`;
                const isLabelVisible = existingPercentage > MIN_LABEL_WIDTH_PERCENT;

                existingBarHtml = `<div class="progress-bar bg-green-500 z-10" style="width: ${barWidth};">
                                    <span class="progress-label p-1 ${isLabelVisible ? '' : 'hidden'}">${existingLabel}</span>
                                </div>`;
            }

            // Render proposed bar and its label
            if (proposed > 0) {
                const proposedLabel = isExistingCustomer ? `+${formatCurrency(proposed, true)}` : `${formatCurrency(totalCoverage, true)}`;
                const leftPosition = isExistingCustomer ? `${Math.min(existingPercentage, 100)}%` : '0';
                const proposedBarColor = (totalCoverage >= benchmark) ? 'bg-green-500' : 'bg-blue-500';
                
                const proposedBarWidth = Math.min(proposedPercentage, 100 - existingPercentage);
                const isLabelVisible = proposedBarWidth > MIN_LABEL_WIDTH_PERCENT;
                
                proposedBarHtml = `<div class="progress-bar ${proposedBarColor} z-20" style="width: ${proposedBarWidth}%; left: ${leftPosition};">
                                    <span class="progress-label p-1 ${isLabelVisible ? '' : 'hidden'}">${proposedLabel}</span>
                                </div>`;
            }


            return `
                <div class="p-4 bg-white rounded-xl shadow-md">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2">
                            ${iconSvg}
                            <h4 class="font-semibold text-gray-700">${title}</h4>
                        </div>
                        <span class="text-sm font-medium text-gray-500">${statusText}</span>
                    </div>

                    <div class="progress-bar-container">
                        ${existingBarHtml}
                        ${proposedBarHtml}
                        <div class="benchmark-marker" style="left: ${Math.min(benchmark / totalCoverage, 1) * 100}%;"></div>
                    </div>

                    <div class="flex justify-between text-xs mt-2 text-gray-600">
                        <span>Total Coverage: ${formatCurrency(totalCoverage)}</span>
                        <span>Benchmark: ${formatCurrency(benchmark)}</span>
                    </div>
                </div>
            `;
        }

        /**
         * Creates a new two-bar comparison chart for total coverage.
         * @param {number} existingTotal The total existing coverage.
         * @param {number} proposedTotal The total proposed coverage.
         * @returns {string} The HTML string for the new two-bar comparison chart.
         */
        function createTwoBarComparisonChart(existingTotal, proposedTotal) {
            const maxValue = Math.max(existingTotal, proposedTotal, 1);
            const existingWidth = (existingTotal / maxValue) * 100;
            const proposedWidth = (proposedTotal / maxValue) * 100;

            return `
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Total Coverage Comparison</h3>
                    <div class="two-bar-comparison-container">
                        <div class="two-bar-comparison-item">
                            <div class="two-bar-comparison-bar bg-green-500" style="width: ${existingWidth}%;"></div>
                        </div>
                        <div class="two-bar-comparison-item">
                            <div class="two-bar-comparison-bar bg-blue-500" style="width: ${proposedWidth}%;"></div>
                        </div>
                    </div>
                    <div class="flex flex-col gap-2 mt-4 text-sm font-medium">
                        <div class="flex justify-between items-center text-gray-700">
                            <span>Existing Coverage:</span>
                            <span class="font-bold text-green-600">${formatCurrency(existingTotal)}</span>
                        </div>
                        <div class="flex justify-between items-center text-gray-700">
                            <span>Proposed Coverage:</span>
                            <span class="font-bold text-blue-600">${formatCurrency(proposedTotal)}</span>
                        </div>
                        <hr class="border-gray-300">
                        <div class="flex justify-between items-center text-gray-800 font-bold text-lg">
                            <span>Total Combined Coverage:</span>
                            <span>${formatCurrency(existingTotal + proposedTotal)}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * Generates the HTML for the summary section.
         * @param {number} proposedPremiumValue The proposed premium value.
         * @param {string} proposedPremiumFrequency The frequency of the proposed premium.
         * @param {number} proposedLife The proposed life coverage.
         * @param {number} proposedCI The proposed CI coverage.
         * @param {number} proposedAccident The proposed accident coverage.
         * @param {number} proposedMedical The proposed medical coverage.
         * @returns {string} The HTML string for the summary section.
         */
        function createSummarySection(proposedPremiumValue, proposedPremiumFrequency, proposedLife, proposedCI, proposedAccident, proposedMedical) {
            const proposedTotalCoverage = proposedLife + proposedCI + proposedAccident + proposedMedical;
            let frequencyText = proposedPremiumFrequency.charAt(0).toUpperCase() + proposedPremiumFrequency.slice(1);
            
            return `
                <div class="space-y-6 mb-8">
                    <div class="p-6 bg-blue-50 rounded-2xl shadow-md">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">Your Coverage Breakdown</h3>
                        <div class="space-y-2 text-lg">
                            <div class="flex justify-between">
                                <span class="text-gray-700">Life Insurance:</span>
                                <span class="text-gray-900 font-bold">${formatCurrency(proposedLife)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-700">Critical Illness:</span>
                                <span class="text-gray-900 font-bold">${formatCurrency(proposedCI)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-700">Accidental:</span>
                                <span class="text-gray-900 font-bold">${formatCurrency(proposedAccident)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-700">Health / Medical:</span>
                                <span class="text-gray-900 font-bold">${formatCurrency(proposedMedical)}</span>
                            </div>
                            <hr class="border-gray-300 my-4">
                            <div class="flex justify-between text-xl font-bold">
                                <span class="text-gray-800">Total Coverage:</span>
                                <span class="text-blue-600">${formatCurrency(proposedTotalCoverage)}</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-blue-50 rounded-2xl shadow-md text-center">
                        <h3 class="text-xl font-semibold text-gray-800">Your ${frequencyText} Investment</h3>
                        <p class="text-4xl font-bold text-blue-600 mt-2">${formatCurrency(proposedPremiumValue)}</p>
                    </div>
                </div>
            `;
        }

        /**
         * Generates the HTML for the existing coverage breakdown, now with a similar UI to the new summary.
         * @param {number} existingLife The existing life coverage.
         * @param {number} existingCI The existing CI coverage.
         * @param {number} existingAccident The existing accident coverage.
         * @param {number} existingMedical The existing medical coverage.
         * @param {number} existingPremiumValue The existing premium value.
         * @param {string} existingPremiumFrequency The frequency of the existing premium.
         * @returns {string} The HTML string for the breakdown.
         */
        function createExistingCoverageBreakdown(existingLife, existingCI, existingAccident, existingMedical, existingPremiumValue, existingPremiumFrequency) {
            const existingTotalCoverage = existingLife + existingCI + existingAccident + existingMedical;
            let frequencyText = existingPremiumFrequency.charAt(0).toUpperCase() + existingPremiumFrequency.slice(1);

            return `
                <div class="p-6 bg-green-50 rounded-2xl shadow-md mt-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">Existing Coverage Breakdown</h3>
                    <div class="space-y-2 text-lg">
                        <div class="flex justify-between">
                            <span class="text-gray-700">Life Insurance:</span>
                            <span class="text-gray-900 font-bold">${formatCurrency(existingLife)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-700">Critical Illness:</span>
                            <span class="text-gray-900 font-bold">${formatCurrency(existingCI)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-700">Accidental:</span>
                            <span class="text-gray-900 font-bold">${formatCurrency(existingAccident)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-700">Health / Medical:</span>
                            <span class="text-gray-900 font-bold">${formatCurrency(existingMedical)}</span>
                        </div>
                        <hr class="border-gray-300 my-4">
                        <div class="flex justify-between text-xl font-bold">
                            <span class="text-gray-800">Total Coverage:</span>
                            <span class="text-green-600">${formatCurrency(existingTotalCoverage)}</span>
                        </div>
                    </div>
                    <div class="p-6 bg-green-50 rounded-2xl shadow-md text-center mt-6">
                        <h3 class="text-xl font-semibold text-gray-800">Your ${frequencyText} Investment</h3>
                        <p class="text-4xl font-bold text-green-600 mt-2">${formatCurrency(existingPremiumValue)}</p>
                    </div>
                </div>
            `;
        }

        /**
         * Creates the legend HTML.
         * @param {boolean} isExistingCustomer Whether the user is an existing customer.
         * @returns {string} The HTML string for the legend.
         */
        function createLegend(isExistingCustomer) {
            let legendHtml = `
                <div class="flex items-center gap-2">
                    <span class="w-4 h-4 rounded-full bg-blue-500"></span>
                    <span>Proposed Coverage</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-4 h-4 rounded-full" style="background-color: #9ca3af;"></span>
                    <span>Benchmark Goal</span>
                </div>
            `;
            if (isExistingCustomer) {
                legendHtml = `
                    <div class="flex items-center gap-2">
                        <span class="w-4 h-4 rounded-full bg-green-500"></span>
                        <span>Existing Coverage</span>
                    </div>
                ` + legendHtml;
            }
            return `<div id="legendContainer" class="flex flex-wrap gap-4 text-sm font-medium text-gray-600 mb-6">${legendHtml}</div>`;
        }


        /**
         * Main function to perform calculations and update the UI.
         */
        function calculateAndDisplay() {
            try {
                // --- Get Input Values ---
                const annualIncome = parseFloat(annualIncomeInput.value) || 0;
                const lifeMultiplier = parseFloat(lifeMultiplierInput.value) || 5;
                const ciMultiplier = parseFloat(ciMultiplierInput.value) || 3;
                const accidentMultiplier = parseFloat(accidentMultiplierInput.value) || 3;
                const medicalBenchmarkValue = parseFloat(medicalBenchmarkInput.value) || 1000000;

                const proposedLife = parseFloat(proposedLifeInput.value) || 0;
                const proposedCI = parseFloat(proposedCIInput.value) || 0;
                const proposedAccident = parseFloat(proposedAccidentInput.value) || 0;
                const proposedMedical = parseFloat(proposedMedicalInput.value) || 0;
                const proposedPremiumValue = parseFloat(proposedPremiumInput.value) || 0;
                const proposedPremiumFrequency = proposedPremiumFrequencySelect.value;
                const proposedAnnualPremium = getAnnualPremium(proposedPremiumValue, proposedPremiumFrequency);

                let existingLife = 0;
                let existingCI = 0;
                let existingAccident = 0;
                let existingMedical = 0;
                let existingPremiumValue = 0;
                let existingPremiumFrequency = 'annually';

                if (isExistingCustomer) {
                    existingLife = parseFloat(existingLifeInput.value) || 0;
                    existingCI = parseFloat(existingCIInput.value) || 0;
                    existingAccident = parseFloat(existingAccidentInput.value) || 0;
                    existingMedical = parseFloat(existingMedicalInput.value) || 0;
                    existingPremiumValue = parseFloat(existingPremiumInput.value) || 0;
                    existingPremiumFrequency = existingPremiumFrequencySelect.value;
                }
                
                const existingAnnualPremium = getAnnualPremium(existingPremiumValue, existingPremiumFrequency);

                // --- Calculate Benchmarks ---
                const lifeBenchmark = annualIncome * lifeMultiplier;
                const ciBenchmark = annualIncome * ciMultiplier;
                const accidentBenchmark = annualIncome * accidentMultiplier;
                const medicalBenchmark = medicalBenchmarkValue;

                // --- Define Icons with new SVG paths ---
                // Shield for Life Coverage
                const lifeIcon = createIcon(`<path d="M12 2l10 5l-10 5l-10-5l10-5z"/><path d="M2 17l10 5l10-5"/><path d="M2 12l10 5l10-5"/>`, 'text-yellow-500');
                // Medical Cross for CI Coverage
                const ciIcon = createIcon(`<path d="M20.5 12.5l-2.5-2.5l-2.5 2.5l2.5 2.5z"/><path d="M22 22l-2-2"/><path d="M7.5 17.5l-2.5-2.5l-2.5 2.5l2.5 2.5z"/><path d="M2 2l2 2"/><path d="M22 2L18 6"/><path d="M12 7l0 10"/>`, 'text-red-500');
                // Lightning bolt for Accident Coverage
                const accidentIcon = createIcon(`<path d="M13 2l-7 10h5l-2 10l9-12h-5l2-10z"/>`, 'text-orange-500');
                // Hospital/cross for Medical Coverage
                const medicalIcon = createIcon(`<path d="M12 5v14M5 12h14"/>`, 'text-blue-500');

                // --- Generate HTML based on Customer Type ---
                let fullResultsHtml = '';

                if (isExistingCustomer) {
                    const totalExistingCoverage = existingLife + existingCI + existingAccident + existingMedical;
                    const totalProposedCoverage = proposedLife + proposedCI + proposedAccident + proposedMedical;
                    
                    fullResultsHtml += `
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-indigo-500"><circle cx="12" cy="12" r="10"/><path d="M8 12l4 4l4-4"/><path d="M12 8l0 4"/></svg>
                            Protection Visuals
                        </h2>
                        ${createLegend(isExistingCustomer)}
                        <div class="space-y-8">
                            <h3 class="text-xl font-medium text-gray-800">Existing Plan vs. Benchmarks</h3>
                            ${createComparisonBlock('Life Coverage', lifeIcon, lifeBenchmark, existingLife, 0, false)}
                            ${createComparisonBlock('CI Coverage', ciIcon, ciBenchmark, existingCI, 0, false)}
                            ${createComparisonBlock('Accident Coverage', accidentIcon, accidentBenchmark, existingAccident, 0, false)}
                            ${createComparisonBlock('Medical Coverage', medicalIcon, medicalBenchmark, existingMedical, 0, false)}
                            ${createExistingCoverageBreakdown(existingLife, existingCI, existingAccident, existingMedical, existingPremiumValue, existingPremiumFrequency)}
                            <h3 class="text-xl font-medium text-gray-800 mt-8 pt-4 border-t border-gray-200">Proposed Plan Impact vs. Benchmarks</h3>
                            ${createComparisonBlock('Life Coverage (Total)', lifeIcon, lifeBenchmark, existingLife, proposedLife, true)}
                            ${createComparisonBlock('CI Coverage (Total)', ciIcon, ciBenchmark, existingCI, proposedCI, true)}
                            ${createComparisonBlock('Accident Coverage (Total)', accidentIcon, accidentBenchmark, existingAccident, proposedAccident, true)}
                            ${createComparisonBlock('Medical Coverage (Total)', medicalIcon, medicalBenchmark, existingMedical, proposedMedical, true)}
                        </div>
                        <div class="mt-8 pt-4 border-t border-gray-200">
                             ${createSummarySection(proposedPremiumValue, proposedPremiumFrequency, proposedLife, proposedCI, proposedAccident, proposedMedical)}
                        </div>
                        <div class="mt-8 pt-4 border-t border-gray-200">
                            ${createTwoBarComparisonChart(totalExistingCoverage, totalProposedCoverage)}
                        </div>
                    `;
                } else {
                    // New customer flow
                    const totalProposedCoverage = proposedLife + proposedCI + proposedAccident + proposedMedical;
                    fullResultsHtml += `
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-indigo-500"><circle cx="12" cy="12" r="10"/><path d="M8 12l4 4l4-4"/><path d="M12 8l0 4"/></svg>
                            Protection Visuals
                        </h2>
                        ${createLegend(isExistingCustomer)}
                        <div class="space-y-8">
                            <h3 class="text-xl font-medium text-gray-800">Proposed Plan vs. Benchmarks</h3>
                            ${createComparisonBlock('Life Coverage', lifeIcon, lifeBenchmark, 0, proposedLife, true)}
                            ${createComparisonBlock('CI Coverage', ciIcon, ciBenchmark, 0, proposedCI, true)}
                            ${createComparisonBlock('Accident Coverage', accidentIcon, accidentBenchmark, 0, proposedAccident, true)}
                            ${createComparisonBlock('Medical Coverage', medicalIcon, medicalBenchmark, 0, proposedMedical, true)}
                        </div>
                        <div class="mt-8 pt-4 border-t border-gray-200">
                            ${createSummarySection(proposedPremiumValue, proposedPremiumFrequency, proposedLife, proposedCI, proposedAccident, proposedMedical)}
                        </div>
                    `;
                }

                resultsPanel.innerHTML = fullResultsHtml;

            } catch (error) {
                console.error("An error occurred during calculation:", error);
            }
        }
        
        /**
         * Resets the proposed plan input fields to zero.
         */
        function resetProposedInputs() {
            proposedLifeInput.value = '';
            proposedCIInput.value = '';
            proposedAccidentInput.value = '';
            proposedMedicalInput.value = '';
            proposedPremiumInput.value = '';
            proposedPremiumFrequencySelect.value = 'annually';
        }

        // --- Event Listeners ---
        const allInputs = document.querySelectorAll('input[type="number"], select');
        allInputs.forEach(input => {
            input.addEventListener('input', calculateAndDisplay);
        });

        // Toggle between New and Existing Customer
        newCustomerBtn.addEventListener('click', () => {
            isExistingCustomer = false;
            existingPolicySection.classList.add('hidden');
            newCustomerBtn.classList.add('bg-blue-600', 'text-white');
            newCustomerBtn.classList.remove('bg-transparent', 'text-gray-600');
            existingCustomerBtn.classList.remove('bg-blue-600', 'text-white');
            existingCustomerBtn.classList.add('bg-transparent', 'text-gray-600');
            // Reset proposed and existing inputs for a clean start
            existingLifeInput.value = '';
            existingCIInput.value = '';
            existingAccidentInput.value = '';
            existingMedicalInput.value = '';
            existingPremiumInput.value = '';
            existingPremiumFrequencySelect.value = 'annually';
            resetProposedInputs();
            calculateAndDisplay();
        });

        existingCustomerBtn.addEventListener('click', () => {
            isExistingCustomer = true;
            existingPolicySection.classList.remove('hidden');
            existingCustomerBtn.classList.add('bg-blue-600', 'text-white');
            existingCustomerBtn.classList.remove('bg-transparent', 'text-gray-600');
            newCustomerBtn.classList.remove('bg-blue-600', 'text-white');
            newCustomerBtn.classList.add('bg-transparent', 'text-gray-600');
            // Reset proposed inputs when switching to existing customer
            resetProposedInputs();
            calculateAndDisplay();
        });

        // Initial calculation on page load
        document.addEventListener('DOMContentLoaded', () => {
            calculateAndDisplay();
        });
    </script>
</body>
</html>
